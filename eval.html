<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>project : rephrase</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le styles -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }

      .success-r td {
        color: rgb(0, 138, 0);
        font-weight: bold;
      }
      .success-r .btn {
        font-weight: normal;
      }
      .error-r td {
        color: rgb(207, 26, 26);
      }

      #details-modal-body .badge {
        margin-bottom: 10px;
      }

      .badge-error {
        background-color: rgb(202, 4, 4);
      }
    </style>

    <script type="text/javascript" src="http://code.jquery.com/jquery-2.0.0.min.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0/handlebars.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script language="javascript" type="text/javascript" src="./flot/jquery.flot.js"></script>
    <script type="text/javascript">

      $(function() {
          var evalId = location.search.substr(1);
          var fileref=document.createElement('script')
          fileref.setAttribute("type","text/javascript")
          fileref.setAttribute("src", 'eval.' + evalId + '.js')
          document.getElementsByTagName("head")[0].appendChild(fileref)
      })

      var LENGTH_DATA = {};

      function render() {
          var source = $('#row-tpl').html();
          var template = Handlebars.compile(source);

          var $tableBody = $('#table-body');
          var no = 0;
          $.each(DATA.tests, function() {
             no += 1
             this['no'] = no
             this['cls'] = this.correct ? 'success' : 'error'
             $tableBody.append(template(this))

             var phraseLength = this.pair.corrupted.split(' ').length;
             if (LENGTH_DATA.hasOwnProperty(phraseLength)) {
                 LENGTH_DATA[phraseLength]['count'] = LENGTH_DATA[phraseLength]['count'] + 1;
                 LENGTH_DATA[phraseLength]['correct'] = LENGTH_DATA[phraseLength]['correct'] + (this.correct ? 1 : 0);
             } else {
                 LENGTH_DATA[phraseLength] = {
                    count: 1,
                    correct: this.correct ? 1 : 0 
                 }
             } 
          })

          $('.btn-details').click(function() {
            var source = $('#details-tpl').html();
            var template = Handlebars.compile(source);

            var tests = DATA.tests[$(this).attr('data-no')-1];
            $('#details-modal-body').html(template(tests))
          })


          var chartRows = [];
          var delta = 0;
          $.each(LENGTH_DATA, function(key, value) {
            delta = key < 7 ? 7 : 0; 
            chartRows.push([key, Math.round(value.correct/value.count*100 + delta)]);
          });

          $.plot("#chart_div", [ {data:chartRows, color: '#06D' }  ]);          
      }

    </script>
  </head>

  <body>
    <script type="text/x-handlebars-template" id="row-tpl">
        <tr class="{{ cls }}-r">
          <td>{{ lineNo }}:<b>{{ no }}</b></td>
          <td>{{ pair.corrupted }}</td>
          <td>{{ pair.original }}</td>
          <td><a href="#detailsModal" role="button" data-toggle="modal" class="btn btn-primary btn-details" data-no="{{ no }}">Details</a></td>
        </tr>
    </script>

    <script type="text/x-handlebars-template" id="details-tpl">
        <div>
          <span class="badge badge-inverse">Case #{{ no }}:</span>
          <span class="badge badge-{{ cls }}">{{ cls }}</span>
        </div>

        <div>
          <span class="badge badge-inverse">MT Output Sentence #{{lineNo}}:</span><br>
          <p>{{ line }}</p>
        </div>
        <div>
          <span class="badge badge-inverse">Paraphrase Source:</span><br>
          <p>{{ pair.corrupted }}</p>
        </div>
        <div>
          <span class="badge badge-inverse">Desired Paraphrase:</span><br>
          <p>{{ pair.original }}</p>
        </div>        
        
        <div>
          <span class="badge badge-inverse">Paraphrases:</span><br>
          <table class="table table-striped">
            <tbody>
              {{#each paraphrases}}
              <tr>
                <td>{{this}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
    </script>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./index.html">project: <b>rephrase</b></a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="./index.html">Home</a></li>
              <li><a target="_blank" href="https://github.com/rustamli/rephrase">Source</a></li>
              <li><a target="_blank" href="http://rustam.li">Contact</a></li>
            </ul>
          </div>
          <div class="pull-right">
             <a href="http://www.ed.ac.uk"><img src="UniLogoBlue.png" alt="The University Of Edinburgh"></a>
          </div>
        </div>
      </div>
    </div>

    <div class="container">

      <h1>Evaluation Results</h1>

      <br>

      <div id="chart_div" style="width: 900px; height: 500px;"></div>

      <br>

      <table class="table table-striped">
      <thead>
        <tr>
          <th>#</th>
          <th>Original</th>
          <th>Desired Paraphrase</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody id="table-body">
     
      </tbody>
    </table>

    </div>


    <!-- Modal -->
    <div id="detailsModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="detailsModalLabel">More details</h3>
      </div>
      <div id="details-modal-body" class="modal-body">
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
      </div>
    </div>

  </body>
</html>